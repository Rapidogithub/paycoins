{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Html5QrcodeScanner}from'html5-qrcode';// Simplified scanner with focus on reliability\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const QRScanner=_ref=>{let{onClose,onScanSuccess,onError}=_ref;const[scanResult,setScanResult]=useState(null);const[error,setError]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Set reasonable delay before initializing\nconst initTimer=setTimeout(()=>{try{initializeQrScanner();}catch(err){console.error(\"Critical init error:\",err);setError(\"Failed to initialize scanner. Please try again or use a different device.\");setLoading(false);}},1000);return()=>{clearTimeout(initTimer);// Clean up scanner element\nconst scannerElement=document.getElementById('reader');if(scannerElement){while(scannerElement.firstChild){scannerElement.removeChild(scannerElement.firstChild);}}};},[]);const initializeQrScanner=()=>{console.log(\"Initializing scanner...\");setLoading(true);// Simple config with minimal options\nconst config={fps:2,qrbox:250,disableFlip:false,showTorchButtonIfSupported:true};try{const scanner=new Html5QrcodeScanner(\"reader\",config,/* verbose= */false);// Define success handler\nconst onScanFinish=decodedText=>{console.log(\"QR code detected:\",decodedText);setScanResult(decodedText);// Try vibration feedback\nif(navigator.vibrate){navigator.vibrate(200);}// Process data\ntry{let parsedData=decodedText;// Handle JSON format (for wallet addresses)\nif(decodedText.startsWith('{')&&decodedText.endsWith('}')){try{const jsonData=JSON.parse(decodedText);if(jsonData.walletAddress){parsedData=jsonData.walletAddress;}}catch(e){console.log(\"Not valid JSON, using raw text\");}}// Pass to parent\nif(onScanSuccess){onScanSuccess(parsedData);}}catch(err){console.error(\"Error processing scan result:\",err);setError(\"Invalid QR code format\");}};// Define error handler\nconst onScanError=errorMessage=>{console.warn(\"QR Scan error:\",errorMessage);// Only show user errors when they're critical\nif(errorMessage.includes(\"Camera access\")||errorMessage.includes(\"permission\")||errorMessage.includes(\"denied\")){setError(\"Camera access denied. Please check your permissions and try again.\");if(onError){onError(\"Camera permission denied\");}}};// Render the scanner\nconsole.log(\"Starting scanner render...\");scanner.render(onScanFinish,onScanError);console.log(\"Scanner render completed\");setLoading(false);}catch(err){console.error(\"Scanner initialization error:\",err);setError(\"Failed to initialize camera. Please check your browser permissions.\");setLoading(false);if(onError){onError(\"Scanner initialization failed\");}}};const handleRetry=()=>{setError(null);setLoading(true);// Clean up existing scanner\nconst scannerElement=document.getElementById('reader');if(scannerElement){while(scannerElement.firstChild){scannerElement.removeChild(scannerElement.firstChild);}}// Add delay before reinitializing\nsetTimeout(()=>{try{initializeQrScanner();}catch(err){console.error(\"Retry failed:\",err);setError(\"Camera initialization failed. Please try again later.\");setLoading(false);}},1000);};return/*#__PURE__*/_jsxs(\"div\",{className:\"qr-scanner my-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"scanner-header\",children:/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-camera\"}),\" Scan QR Code\"]})}),/*#__PURE__*/_jsx(\"p\",{className:\"scanner-instructions\",children:\"Point your camera at a wallet QR code to scan it\"}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-info\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-spinner fa-spin\"}),\" Initializing camera...\"]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-danger\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-exclamation-circle\"}),\" \",error,/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-sm btn-primary mr-2\",onClick:handleRetry,children:\"Retry\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-sm btn-light\",onClick:onClose,children:\"Cancel\"})]})]}),scanResult?/*#__PURE__*/_jsxs(\"div\",{className:\"scan-result\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-success\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check-circle\"}),/*#__PURE__*/_jsx(\"strong\",{children:\"Scan successful!\"}),\" Address detected.\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:onClose,children:\"Continue\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"scan-container\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"reader\",className:\"reader-container\"}),!loading&&!error&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-light mt-3\",onClick:onClose,children:\"Cancel\"})]})]});};export default QRScanner;","map":{"version":3,"names":["React","useState","useEffect","Html5QrcodeScanner","jsx","_jsx","jsxs","_jsxs","QRScanner","_ref","onClose","onScanSuccess","onError","scanResult","setScanResult","error","setError","loading","setLoading","initTimer","setTimeout","initializeQrScanner","err","console","clearTimeout","scannerElement","document","getElementById","firstChild","removeChild","log","config","fps","qrbox","disableFlip","showTorchButtonIfSupported","scanner","onScanFinish","decodedText","navigator","vibrate","parsedData","startsWith","endsWith","jsonData","JSON","parse","walletAddress","e","onScanError","errorMessage","warn","includes","render","handleRetry","className","children","onClick","id"],"sources":["C:/Users/user/Documents/pay/client/src/components/wallet/QRScanner.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Html5QrcodeScanner } from 'html5-qrcode';\r\n\r\n// Simplified scanner with focus on reliability\r\nconst QRScanner = ({ onClose, onScanSuccess, onError }) => {\r\n  const [scanResult, setScanResult] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  useEffect(() => {\r\n    // Set reasonable delay before initializing\r\n    const initTimer = setTimeout(() => {\r\n      try {\r\n        initializeQrScanner();\r\n      } catch (err) {\r\n        console.error(\"Critical init error:\", err);\r\n        setError(\"Failed to initialize scanner. Please try again or use a different device.\");\r\n        setLoading(false);\r\n      }\r\n    }, 1000);\r\n    \r\n    return () => {\r\n      clearTimeout(initTimer);\r\n      // Clean up scanner element\r\n      const scannerElement = document.getElementById('reader');\r\n      if (scannerElement) {\r\n        while (scannerElement.firstChild) {\r\n          scannerElement.removeChild(scannerElement.firstChild);\r\n        }\r\n      }\r\n    };\r\n  }, []);\r\n  \r\n  const initializeQrScanner = () => {\r\n    console.log(\"Initializing scanner...\");\r\n    setLoading(true);\r\n    \r\n    // Simple config with minimal options\r\n    const config = {\r\n      fps: 2,\r\n      qrbox: 250,\r\n      disableFlip: false,\r\n      showTorchButtonIfSupported: true\r\n    };\r\n    \r\n    try {\r\n      const scanner = new Html5QrcodeScanner(\r\n        \"reader\",\r\n        config,\r\n        /* verbose= */ false\r\n      );\r\n      \r\n      // Define success handler\r\n      const onScanFinish = (decodedText) => {\r\n        console.log(\"QR code detected:\", decodedText);\r\n        setScanResult(decodedText);\r\n        \r\n        // Try vibration feedback\r\n        if (navigator.vibrate) {\r\n          navigator.vibrate(200);\r\n        }\r\n        \r\n        // Process data\r\n          try {\r\n            let parsedData = decodedText;\r\n          // Handle JSON format (for wallet addresses)\r\n            if (decodedText.startsWith('{') && decodedText.endsWith('}')) {\r\n              try {\r\n              const jsonData = JSON.parse(decodedText);\r\n              if (jsonData.walletAddress) {\r\n                parsedData = jsonData.walletAddress;\r\n                }\r\n              } catch (e) {\r\n              console.log(\"Not valid JSON, using raw text\");\r\n            }\r\n          }\r\n          \r\n          // Pass to parent\r\n          if (onScanSuccess) {\r\n            onScanSuccess(parsedData);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Error processing scan result:\", err);\r\n          setError(\"Invalid QR code format\");\r\n        }\r\n      };\r\n      \r\n      // Define error handler\r\n      const onScanError = (errorMessage) => {\r\n        console.warn(\"QR Scan error:\", errorMessage);\r\n        // Only show user errors when they're critical\r\n        if (\r\n          errorMessage.includes(\"Camera access\") ||\r\n          errorMessage.includes(\"permission\") ||\r\n          errorMessage.includes(\"denied\")\r\n        ) {\r\n          setError(\"Camera access denied. Please check your permissions and try again.\");\r\n          if (onError) {\r\n            onError(\"Camera permission denied\");\r\n          }\r\n        }\r\n      };\r\n      \r\n      // Render the scanner\r\n      console.log(\"Starting scanner render...\");\r\n      scanner.render(onScanFinish, onScanError);\r\n      console.log(\"Scanner render completed\");\r\n      setLoading(false);\r\n\r\n    } catch (err) {\r\n      console.error(\"Scanner initialization error:\", err);\r\n      setError(\"Failed to initialize camera. Please check your browser permissions.\");\r\n      setLoading(false);\r\n          if (onError) {\r\n        onError(\"Scanner initialization failed\");\r\n      }\r\n    }\r\n  };\r\n  \r\n  const handleRetry = () => {\r\n    setError(null);\r\n    setLoading(true);\r\n    \r\n    // Clean up existing scanner\r\n    const scannerElement = document.getElementById('reader');\r\n    if (scannerElement) {\r\n      while (scannerElement.firstChild) {\r\n        scannerElement.removeChild(scannerElement.firstChild);\r\n      }\r\n    }\r\n    \r\n    // Add delay before reinitializing\r\n    setTimeout(() => {\r\n      try {\r\n        initializeQrScanner();\r\n      } catch (err) {\r\n        console.error(\"Retry failed:\", err);\r\n        setError(\"Camera initialization failed. Please try again later.\");\r\n        setLoading(false);\r\n      }\r\n    }, 1000);\r\n  };\r\n\r\n  return (\r\n    <div className=\"qr-scanner my-4\">\r\n      <div className=\"scanner-header\">\r\n        <h3>\r\n          <i className=\"fas fa-camera\"></i> Scan QR Code\r\n        </h3>\r\n      </div>\r\n      \r\n      <p className=\"scanner-instructions\">\r\n        Point your camera at a wallet QR code to scan it\r\n      </p>\r\n      \r\n      {loading && (\r\n        <div className=\"alert alert-info\">\r\n          <i className=\"fas fa-spinner fa-spin\"></i> Initializing camera...\r\n        </div>\r\n      )}\r\n      \r\n      {error && (\r\n        <div className=\"alert alert-danger\">\r\n          <i className=\"fas fa-exclamation-circle\"></i> {error}\r\n          <div className=\"mt-2\">\r\n            <button \r\n              className=\"btn btn-sm btn-primary mr-2\"\r\n              onClick={handleRetry}\r\n            >\r\n              Retry\r\n            </button>\r\n            <button \r\n              className=\"btn btn-sm btn-light\"\r\n              onClick={onClose}\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {scanResult ? (\r\n        <div className=\"scan-result\">\r\n          <div className=\"alert alert-success\">\r\n            <i className=\"fas fa-check-circle\"></i>\r\n            <strong>Scan successful!</strong> Address detected.\r\n          </div>\r\n          <button \r\n            className=\"btn btn-primary\"\r\n            onClick={onClose}\r\n          >\r\n            Continue\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"scan-container\">\r\n          <div id=\"reader\" className=\"reader-container\"></div>\r\n          {!loading && !error && (\r\n          <button \r\n            className=\"btn btn-light mt-3\"\r\n            onClick={onClose}\r\n          >\r\n            Cancel\r\n          </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QRScanner; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}